<!DOCTYPE html>
<html lang="en">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <link href="styles.css" rel="stylesheet">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>watchlist</title>
    
</head>

<body>
    <nav class="navbar navbar-dark bg-dark px-3 navbar-expand-lg">
        <a class="navbar-brand" href="index.html">Logo</a>
    
        <ul class="navbar-nav ms-auto">
             <li class="nav-item" id="nav-watchlist">
                <a href="watchlist.html" class="nav-link">Watchlist</a>
            </li>
            <li class="nav-item" id="nav-login">
                <a href="login.html" class="nav-link">Log in</a>
            </li>
            <li class="nav-item" id="nav-logout">
                <a href="index.html" class="nav-link">Log out</a>
            </li>
        </ul>
    </nav>
    <form class="nosubmit">
        <input class="nosubmit" type="search" placeholder="Search..." id="searchBar">
    </form>
    <div class="top-container">
        <p id="watchlistText" >Watchlist</p>
        <div id="sortBy">
            <button type="button" class="btn btn-dark " >Sort by</button>
        </div>

    </div>
    
    <div class="watchlist-container" id="watchlist-container">

    </div>
  


</body>

<script src="navbar-script.js"></script>
<script src="api.js"></script>
<script>
    let watchlist=[]
    let id= document.getElementById('watchlist-container');
    function renderWatchlist(){
            
        
        const watchlistLength= watchlist.length;
        
        id.innerHTML=''
        for(let i=0;i<watchlistLength;i++){
            id.innerHTML+= `<div class="Watchlist">
                
                <img src=${watchlist[i].imageURL} alt="movie thumbnail" class="w-full h-[300px] object-cover rounded-lg" id="movieImage">
                <span class="text-lg font-medium truncate overflow-hidden ... mr-8">${watchlist[i].title}</span>
                    
               
                
            
                <button type="button" class="btn btn-dark " id="deleteButton" onClick="removeWatchlist(${watchlist[i]._id})">-</button>
            </div>`
        }
        
        if(id.clientWidth<id.scrollWidth){
            
            id.innerHTML+= `<button type="button" class="btn btn-light" id="scrollleft" onClick="scrollRight()">></button>`
            
        }
    }
    
    function getWatchlist(){
        fetch(`${API_URL}/watchlist/`,{
            method: 'GET',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'authorization':JSON.parse(localStorage.getItem('user')).jwt
            }
        }).then(response=>response.json()).then(data=>{

            watchlist= data.watchlist;
            renderWatchlist();
            
            
        }).catch(error=>{
            console.log(err)
        })
    }
    function scrollRight(){
        
        id.scrollLeft+=100
    }
    
    
    getWatchlist();
    document.getElementById('searchBar').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        e.preventDefault()
        watchlist= watchlist.filter((item)=>{
            return item.title.includes(document.getElementById('searchBar'))
        })
        renderWatchlist();
        
    }
    
})
function removeWatchlist(id){
    fetch(`${API_URL}/watchlist/${id}`,{
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'authorization':JSON.parse(localStorage.getItem('user')).jwt
            }}
    ).then(response=>{
        getWatchlist();
    }).catch(error=>console.log(error))
}

</script>



</html>
